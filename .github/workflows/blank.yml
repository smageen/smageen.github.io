name: Import Cydia DEBs

on:
  workflow_dispatch:

jobs:
  import-debs:
    runs-on: ubuntu-latest
    timeout-minutes: 600  # ‚è± 10 —á–∞—Å–æ–≤
    strategy:
      matrix:
        part: [part1.zip, part2.zip, part3.zip, part4.zip, part5.zip]

    steps:
    - name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–∞
      run: df -h

    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
      run: sudo apt-get update && sudo apt-get install -y pv unzip dpkg-dev

    - name: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ ${{ matrix.part }}
      run: |
        echo "üîΩ –ó–∞–≥—Ä—É–∑–∫–∞ ${{ matrix.part }}..."
        wget -c https://archive.org/download/cydia_repository_archive/${{ matrix.part }} -O ${{ matrix.part }}
        echo "‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞."

    - name: –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
      run: |
        echo "üì¶ –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ ${{ matrix.part }}..."
        mkdir -p repo/debs
        pv ${{ matrix.part }} | unzip -o -d repo/debs -

    - name: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
      run: |
        echo "üìÑ –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ ${{ matrix.part }}:"
        find repo/debs/ -type f -name "*.deb" | tee debs_list_${{ matrix.part }}.txt

    - name: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Packages
      run: |
        echo "üßæ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Packages..."
        cd repo
        dpkg-scanpackages debs/ /dev/null > Packages
        gzip -9 < Packages > Packages.gz

    - name: –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
      uses: actions/upload-artifact@v4
      with:
        name: repo-${{ matrix.part }}
        path: repo/
