name: Import All Cydia .7z Repos

on:
  workflow_dispatch:

jobs:
  import-debs:
    runs-on: ubuntu-latest
    timeout-minutes: 600

    steps:
    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
      run: sudo apt-get update && sudo apt-get install -y p7zip-full dpkg-dev

    - name: –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏
      run: mkdir -p repo/debs

    - name: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–æ–≤
      run: |
        urls=(
          "apptapp.saurik.com.7z"
          "apt.saurik.com-(ios_main_).7z"
          "apt.thebigboss.org_repofiles_cydia-(_stable_main_).7z"
          "artillect.github.io_repo.7z"
          "cydia.bag-xml.com.7z"
          "cydia.invoxiplaygames.uk.7z"
          "cydia.invoxiplaygames.uk_beta.7z"
          "evynw.github.io.7z"
          "havoc.app.7z"
          "ios3.party.7z"
          "pwnage.dev.7z"
          "repo.dynastic.co.7z"
          "repo.mtmdev.org.7z"
        )

        for file in "${urls[@]}"; do
          echo "üîΩ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ $file..."
          wget -c "https://archive.org/download/cydia_repository_archive/$file" -O "$file"
          echo "üì¶ –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ $file..."
          7z x "$file" -orepo/debs
        done

    - name: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Packages
      run: |
        echo "üßæ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Packages..."
        cd repo
        dpkg-scanpackages debs/ /dev/null > Packages
        gzip -9 < Packages > Packages.gz

    - name: –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
      uses: actions/upload-artifact@v4
      with:
        name: full-cydia-repo
        path: repo/
