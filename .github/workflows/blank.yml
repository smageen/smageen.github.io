name: Import Cydia Repos

on:
  workflow_dispatch:

jobs:
  import-debs:
    strategy:
      matrix:
        archive:
          - apt.thebigboss.org_repofiles_cydia.7z
          - repo.dynastic.co.7z
          - havoc.app.7z
          - repo.packix.com.7z
          - chariz.com.7z
          - twickd.com.7z
          - c1d3r.com.7z
          - ios.jjolano.me.7z
          - repo.pixelomer.com.7z
          - repo.co.kr.7z
          - repo.nepeta.me.7z
          - repo.rpgfarm.com.7z
          - repo.xsf1.re.7z
          - repo.zebra.sh.7z

    runs-on: ubuntu-latest

    steps:
      - name: ‚è≥ Start processing ${{ matrix.archive }}
        run: echo "üîÑ –ù–∞—á–∏–Ω–∞—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∞—Ä—Ö–∏–≤–∞ ${{ matrix.archive }}"

      - name: üì• Download archive
        run: |
          echo "üì¶ –ó–∞–≥—Ä—É–∂–∞—é ${{ matrix.archive }}..."
          curl -L "https://archive.org/download/cydia_repository_archive/${{ matrix.archive }}" -o "${{ matrix.archive }}"

      - name: üìÇ Extract archive
        run: |
          echo "üì§ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞—é ${{ matrix.archive }}..."
          sudo apt-get update
          sudo apt-get install -y p7zip-full
          mkdir -p repo/debs
          7z x "${{ matrix.archive }}" -orepo/debs
          echo "üßπ –£–¥–∞–ª—è—é –∏—Å—Ö–æ–¥–Ω—ã–π –∞—Ä—Ö–∏–≤..."
          rm "${{ matrix.archive }}"

      - name: üìä Show disk usage
        run: |
          echo "üìà –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ:"
          df -h

      - name: üì¶ Upload extracted debs
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.archive }}-debs
          path: repo/debs

      - name: ‚úÖ Done with ${{ matrix.archive }}
        run: echo "‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ${{ matrix.archive }}"

  finalize:
    needs: import-debs
    runs-on: ubuntu-latest
    steps:
      - name: üß© Final step
        run: echo "üéâ –í—Å–µ –∞—Ä—Ö–∏–≤—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã. –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã."

